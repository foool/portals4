<?xml version="1.0"?>
<test>
  <repeat count="2">
    <subtest>
      <desc>Test PtlLEAppend without init</desc>
      <arg_check>
        <ptl_le_append ret="NO_INIT"/>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEUnlink without init</desc>
      <arg_check>
        <ptl_le_unlink ret="NO_INIT"/>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLESearch without init</desc>
      <arg_check>
        <ptl_le_search ret="NO_INIT"/>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with unsupported options</desc>
      <arg_check>
        <ptl>
          <ptl_le_append le_opt="INVALID" ret="ARG_INVALID"/>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLESearch with unsupported options</desc>
      <arg_check>
        <ptl>
          <ptl_le_search le_opt="INVALID" ret="ARG_INVALID"/>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with ni_handle = INVALID</desc>
      <arg_check>
        <ptl>
          <ptl_le_append ni_handle="INVALID" ret="ARG_INVALID"/>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLESearch with ni_handle = INVALID</desc>
      <arg_check>
        <ptl>
          <ptl_le_search ni_handle="INVALID" ret="ARG_INVALID"/>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with matching ni</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="MATCH PHYSICAL">
            <ptl_le_append ret="ARG_INVALID"/>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLESearch with matching ni</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="MATCH PHYSICAL">
            <ptl_le_search ret="ARG_INVALID"/>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with ct_handle = INVALID</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL">
            <ptl_pt>
              <ptl_le_append ct_handle="INVALID" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with ct from wrong ni</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="MATCH PHYSICAL">
            <ptl_ct>
              <ptl_ni ni_opt="NO_MATCH PHYSICAL">
                <ptl_pt pt_index="3">
                  <ptl_le_append ret="ARG_INVALID">
                    <if err="ARG_INVALID">
                    </if>
                    <if err="OK">
                      <!-- cleanup if it succeeded anyway -->
                      <ptl_le_unlink/>
                    </if>
                  </ptl_le_append>
                </ptl_pt>
              </ptl_ni>
            </ptl_ct>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with bad ptl_list(1)</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL">
            <ptl_pt pt_index="3">
              <ptl_le_append list="INVALID" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with bad ptl_list(2)</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL">
            <ptl_pt pt_index="3">
              <ptl_le_append list="2" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLESearch with bad search_op(1)</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL">
            <ptl_pt pt_index="3">
              <ptl_le_search search_op="INVALID" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLESearch with bad search_op(2)</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL">
            <ptl_pt pt_index="3">
              <ptl_le_search search_op="2" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with invalid pt_index = 0</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL">
            <ptl_pt pt_index="3">
              <ptl_le_append pt_index="0" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend with invalid pt_index = out of range</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL" desired_max_pt_index="4">
            <check actual_max_pt_index="4"/>
            <ptl_pt pt_index="3">
              <ptl_le_append pt_index="5" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLESearch with invalid pt_index = 0</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL">
            <ptl_pt pt_index="3">
              <ptl_le_search pt_index="0" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLESearch with invalid pt_index = out of range</desc>
      <arg_check>
        <ptl>
          <ptl_ni ni_opt="NO_MATCH PHYSICAL" desired_max_pt_index="4">
            <check actual_max_pt_index="4"/>
            <ptl_pt pt_index="3">
              <ptl_le_search pt_index="5" ret="ARG_INVALID"/>
            </ptl_pt>
          </ptl_ni>
        </ptl>
      </arg_check>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend/Unlink with good parameters</desc>
      <ptl>
        <ptl_ni ni_opt="NO_MATCH PHYSICAL">
          <ptl_pt pt_index="3">
            <ptl_le pt_index="3"/>
          </ptl_pt>
        </ptl_ni>
      </ptl>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend/Unlink with TARGET_BIND_INACCESSIBLE</desc>
      <ptl>
        <ptl_ni ni_opt="NO_MATCH PHYSICAL" desired_features="TARGET_BIND_INACCESSIBLE">
          <ptl_pt>
            <ptl_le/>
          </ptl_pt>
        </ptl_ni>
      </ptl>
    </subtest>
    <subtest>
      <desc>Test PtlLEAppend/Unlink with TARGET_BIND_INACCESSIBLE + PTL_LE_IS_ACCESSIBLE</desc>
      <ptl>
        <ptl_ni ni_opt="NO_MATCH PHYSICAL" desired_features="TARGET_BIND_INACCESSIBLE">
          <ptl_pt>
            <ptl_le le_opt="IS_ACCESSIBLE"/>
          </ptl_pt>
        </ptl_ni>
      </ptl>
    </subtest>
  </repeat>
</test>
